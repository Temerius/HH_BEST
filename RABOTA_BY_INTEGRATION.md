# Интеграция с rabota.by

## Обзор

Проект переходит с API HeadHunter на работу с данными rabota.by. Структура базы данных и DAG'и обновлены для поддержки всех необходимых полей и фильтров.

## Структура данных

### Новые поля в таблице `vacancies.vacancies`

#### Полные описания (вместо кратких snippet):
- `tasks` (TEXT) - Задачи вакансии
- `requirements` (TEXT) - Мы ожидаем (полные требования)
- `advantages` (TEXT) - Будет плюсом
- `offers` (TEXT) - Мы предлагаем
- `description` (TEXT) - Общее описание

#### Дополнительные поля для фильтров:
- `education_id` / `education_name` - Образование
- `specialization_id` - Основная специализация
- `coordinates_accuracy` - Точность координат (для карты)

### Новые таблицы

1. **vacancies.industries** - Отрасли компаний
2. **vacancies.specializations** - Специализации (иерархическая структура)
3. **vacancies.metro_stations_by** - Станции метро для РБ
4. **vacancies.vacancy_metro_by** - Связь вакансий и метро (many-to-many)
5. **vacancies.vacancy_specializations** - Связь вакансий и специализаций (many-to-many)
6. **vacancies.vacancy_skills** - Ключевые навыки вакансий

### Обновленные таблицы

**vacancies.employers:**
- `industry_id` / `industry_name` - Отрасль компании
- `company_description` - Описание компании
- `company_size` - Размер компании
- `company_website` - Сайт компании

## Фильтры

Поддерживаемые фильтры в API `/api/vacancies`:

1. **Уровень дохода**: `salary_from`, `salary_to`
2. **Валюта**: `salary_currency` (BYN, USD, EUR, RUR)
3. **Регион**: `area_id` (регионы РБ)
4. **Метро**: `metro_id` (станции метро)
5. **Специализации**: `specialization_id`
6. **Отрасль компании**: `industry_id`
7. **Образование**: `education_id`
8. **Опыт работы**: `experience_id`
9. **Тип занятости**: `employment_id`
10. **График работы**: `schedule_id`
11. **Формат работы**: `work_format_id`

## Структура карточки вакансии

В ответе API вакансия содержит:

- `description` - Общее описание
- `tasks` - Задачи
- `requirements` - Мы ожидаем
- `advantages` - Будет плюсом
- `offers` - Мы предлагаем
- `skills` - Ключевые навыки (массив строк)
- `metro_stations` - Станции метро (массив объектов)
- `address_lat` / `address_lng` - Координаты для карты

## DAG'и

### 1. `rabota_fetch_new_vacancies`
- Загружает новые вакансии за последние 14 дней
- Запускается каждые 6 часов
- Загружает справочники (регионы, специализации, отрасли, метро)

### 2. `rabota_update_existing_vacancies`
- Обновляет существующие вакансии
- Загружает полную информацию (tasks, requirements, advantages, offers)
- Запускается каждые 12 часов

### 3. `rabota_archive_old_vacancies`
- Архивирует вакансии старше 14 дней
- Запускается раз в день

## Миграция

Для применения изменений выполните:

```sql
\i migrations/004_rabota_by_schema.sql
```

## Примечания

⚠️ **Важно**: rabota.by может не иметь публичного API. DAG'и подготовлены как заглушки и требуют реализации логики получения данных в зависимости от доступного метода:

1. **Если есть API**: обновите URL и параметры запросов в DAG'ах
2. **Если используется парсинг**: реализуйте логику парсинга HTML/JSON
3. **Если используется RSS/экспорт**: адаптируйте DAG'и под формат данных

## Следующие шаги

1. Определить метод получения данных с rabota.by
2. Реализовать логику в DAG'ах для реального источника данных
3. Протестировать загрузку и сохранение данных
4. Обновить фронтенд для отображения новых полей
5. Добавить фильтры на фронтенде

