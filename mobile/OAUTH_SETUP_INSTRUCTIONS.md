# Инструкция по настройке Google OAuth для мобильного приложения

## Проблема: redirect_uri_mismatch

Эта ошибка означает, что redirect URI, который использует приложение, не зарегистрирован в Google Cloud Console.

## Решение

### Шаг 1: Определите ваш redirect URI

Когда мобильное приложение отправляет запрос на:
```
http://192-168-100-4.nip.io:8000/api/auth/google/login
```

Бэкенд автоматически формирует redirect URI на основе URL запроса:
```
http://192-168-100-4.nip.io:8000/api/auth/google/callback
```

**Важно:** Замените `192-168-100-4` на ваш реальный IP-адрес, если он отличается.

### Шаг 2: Добавьте redirect URI в Google Cloud Console

1. Откройте [Google Cloud Console](https://console.cloud.google.com/)
2. Выберите ваш проект
3. Перейдите в **APIs & Services** → **Credentials**
4. Найдите ваш **OAuth 2.0 Client ID** (тип: **Web application**)
5. Нажмите на него для редактирования
6. В разделе **Authorized redirect URIs** нажмите **+ ADD URI**
7. Добавьте точно такой URI (замените IP на ваш, если отличается):
   ```
   http://192-168-100-4.nip.io:8000/api/auth/google/callback
   ```
8. Нажмите **SAVE**

### Шаг 3: Проверьте настройки

Убедитесь, что:
- ✅ Redirect URI **точно совпадает** (включая протокол `http://`, порт `:8000`, путь `/api/auth/google/callback`)
- ✅ Нет лишних пробелов или символов в начале/конце
- ✅ Используется правильный синтаксис nip.io с **дефисами**: `192-168-100-4` (не `192.168.100.4`)
- ✅ Протокол `http://` (не `https://`)

### Шаг 4: Также добавьте для фронтенда (если еще не добавлено)

Для веб-версии также нужно добавить:
```
http://localhost:8000/api/auth/google/callback
```

### Шаг 5: Если IP изменился

Если IP-адрес вашего компьютера изменился:

1. Обновите `oauthBaseUrl` в `mobile/lib/config/api_config.dart`:
   ```dart
   static const String oauthBaseUrl = 'http://НОВЫЙ-IP.nip.io:8000';
   ```
   Например: `http://192-168-100-5.nip.io:8000`

2. Обновите redirect URI в Google Console:
   ```
   http://НОВЫЙ-IP.nip.io:8000/api/auth/google/callback
   ```

3. Пересоберите приложение:
   ```bash
   flutter clean
   flutter pub get
   flutter run
   ```

## Проверка работы nip.io

Убедитесь, что nip.io правильно резолвится:
- Откройте в браузере на компьютере: `http://192-168-100-4.nip.io:8000/api/health` (или любой другой endpoint)
- Должен открыться ваш бэкенд

## Важные замечания

1. **nip.io синтаксис**: Используйте дефисы, а не точки: `192-168-100-4.nip.io` (не `192.168.100.4.nip.io`)
2. **Порт обязателен**: Убедитесь, что порт `:8000` указан в redirect URI
3. **Протокол**: Используйте `http://` для локальной разработки
4. **Точное совпадение**: Redirect URI в Google Console должен **точно совпадать** с тем, что отправляет бэкенд

## Отладка

Если ошибка все еще возникает:

1. Проверьте логи бэкенда - какой redirect_uri он отправляет в Google
2. Проверьте в Google Console - какие redirect URIs зарегистрированы
3. Убедитесь, что они **полностью совпадают** (включая регистр, пробелы, протокол, порт, путь)

## Альтернативные решения

Если nip.io не работает, можно использовать:
- **xip.io** (аналогичный сервис): `http://192.168.100.4.xip.io:8000`
- Настройка локального DNS
- Использование ngrok или подобных туннелей для получения публичного URL

